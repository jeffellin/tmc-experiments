#@ load("@ytt:data", "data")
---
apiVersion: source.toolkit.fluxcd.io/v1beta2
kind: OCIRepository
metadata:
  name: minio-bitnami
  namespace: flux-system
spec:
  type: oci
  interval: 5m0s
  url: oci://registry-1.docker.io/bitnamicharts/minio
  ref:
    tag: 14.6.16
---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: minio-bitnami
  namespace: flux-system
spec:
  interval: 5m
  chartRef:
    kind: OCIRepository
    name: minio-bitnami
    namespace: flux-system
  values:
    persistence:
      storageClass: nfs-client
      size: 500Gi
    ingress:
      enabled: true
      hostname: #@ data.values.domain
      annotations:
        cert-manager.io/cluster-issuer: letsencrypt-contour-cluster-issuer
      tls:
        enabled: true
        autoGenerated: true